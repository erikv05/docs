---
title: 'Extract Metadata'
description: 'Extract structured metadata from video using ROI configuration'
openapi: 'POST /api/v1/vision/extract-metadata'
---

## POST /api/v1/vision/extract-metadata

Extract structured metadata from video using a provided ROI configuration. Monitors video frames and uses OCR to extract data matching your provided schema. Ideal for generating play-by-play events, tracking score changes, or monitoring any on-screen data.

### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| video | File | No* | Video file to process |
| video_url | URL | No* | URL to video file |
| roi_config | object | Yes | ROI configuration from detect-rois endpoint |
| output_schema | object | Yes | JSON Schema defining the event structure to extract |
| skip_frames | integer | No | Process every Nth frame (default: 2) |

*Either `video` or `video_url` is required.

### Response

| Field | Description |
|-------|-------------|
| events | Array of extracted events matching your schema |
| metadata_url | URL to download the full metadata JSON |
| video_duration_sec | Duration of processed video |
| events_detected | Total number of events detected |
| processing_stats | Frame count, processing time, FPS |

### Example Request

```bash
curl -X POST https://api.usenarrative.ai/api/v1/vision/extract-metadata \
  -H "Content-Type: multipart/form-data" \
  -F "video=@football_game.mp4" \
  -F 'roi_config={
    "play_clock": {"y_min": 45, "x_min": 580, "y_max": 75, "x_max": 640},
    "game_clock": {"y_min": 45, "x_min": 480, "y_max": 75, "x_max": 560},
    "home_score": {"y_min": 45, "x_min": 200, "y_max": 75, "x_max": 250},
    "away_score": {"y_min": 45, "x_min": 300, "y_max": 75, "x_max": 350}
  }' \
  -F 'output_schema={
    "type": "object",
    "properties": {
      "event_type": {"type": "string", "enum": ["play_start", "play_end", "score_change", "quarter_change"]},
      "timestamp_sec": {"type": "number"},
      "frame_number": {"type": "integer"},
      "game_clock": {"type": "string"},
      "play_clock": {"type": "integer"},
      "home_score": {"type": "integer"},
      "away_score": {"type": "integer"},
      "is_scoring_play": {"type": "boolean"}
    }
  }'
```

### Example Response

```json
{
  "events": [
    {
      "event_type": "play_start",
      "timestamp_sec": 125.5,
      "frame_number": 3765,
      "game_clock": "12:35",
      "play_clock": 40,
      "home_score": 7,
      "away_score": 3,
      "is_scoring_play": false
    },
    {
      "event_type": "play_end",
      "timestamp_sec": 138.2,
      "frame_number": 4146,
      "game_clock": "12:22",
      "play_clock": null,
      "home_score": 7,
      "away_score": 3,
      "is_scoring_play": false
    },
    {
      "event_type": "score_change",
      "timestamp_sec": 892.4,
      "frame_number": 26772,
      "game_clock": "8:15",
      "play_clock": null,
      "home_score": 14,
      "away_score": 3,
      "is_scoring_play": true
    }
  ],
  "metadata_url": "https://cdn.usenarrative.ai/metadata/events_abc123.json",
  "video_duration_sec": 7200,
  "events_detected": 142,
  "processing_stats": {
    "frames_processed": 108000,
    "processing_time_sec": 245.5,
    "fps": 30.0
  }
}
```

### Workflow

1. **Detect ROIs** - Use `/api/v1/vision/detect-rois` to identify element locations
2. **Define Schema** - Create a JSON Schema for the events you want to extract
3. **Extract Metadata** - Pass ROI config and schema to extract structured data
4. **Use Metadata** - Feed into highlights generation or search indexing

### Schema Examples

#### Football Play-by-Play
```json
{
  "type": "object",
  "properties": {
    "play_id": {"type": "string"},
    "event_type": {"type": "string", "enum": ["play_start", "play_end", "timeout", "score"]},
    "timestamp_sec": {"type": "number"},
    "quarter": {"type": "string"},
    "game_clock": {"type": "string"},
    "down": {"type": "integer"},
    "distance": {"type": "integer"},
    "home_score": {"type": "integer"},
    "away_score": {"type": "integer"},
    "is_touchdown": {"type": "boolean"},
    "is_turnover": {"type": "boolean"}
  }
}
```

#### Basketball Score Tracking
```json
{
  "type": "object",
  "properties": {
    "event_type": {"type": "string", "enum": ["score_change", "foul", "timeout"]},
    "timestamp_sec": {"type": "number"},
    "period": {"type": "integer"},
    "game_clock": {"type": "string"},
    "home_score": {"type": "integer"},
    "away_score": {"type": "integer"},
    "points_scored": {"type": "integer"}
  }
}
```

### Notes

- Processing time scales with video length (~5 minutes per hour of video with skip_frames=2)
- Use higher skip_frames values for faster processing at the cost of precision
- The ROI config can be reused across videos with the same broadcast format
- Events are detected based on state changes in the monitored regions

### Using Metadata with Generate Highlights

The metadata JSON from this endpoint can be passed directly to the [Generate Highlights](/api-reference/clipping/generate-highlights) endpoint for enhanced accuracy. When metadata is provided, highlight generation uses:

- **Precise timestamps** for scoring plays, turnovers, and big moments
- **Score context** to identify game-changing plays
- **Play boundaries** to avoid cutting mid-play

```bash
# Step 1: Detect ROIs
curl -X POST https://api.usenarrative.ai/api/v1/vision/detect-rois \
  -F "video=@game.mp4" \
  -F 'elements=[...]'

# Step 2: Extract metadata
curl -X POST https://api.usenarrative.ai/api/v1/vision/extract-metadata \
  -F "video=@game.mp4" \
  -F 'roi_config={...}' \
  -F 'output_schema={...}' \
  -o metadata.json

# Step 3: Generate highlights with metadata
curl -X POST https://api.usenarrative.ai/api/v1/highlights/generate \
  -F "video=@game.mp4" \
  -F "metadata=@metadata.json"
```

<Card title="Generate Highlights" icon="wand-magic-sparkles" href="/api-reference/clipping/generate-highlights">
  Use extracted metadata for more accurate highlight generation
</Card>
